{"version":3,"file":"database-541a19be.js","sources":["../../../.svelte-kit/adapter-node/chunks/database.js"],"sourcesContent":["import { d as MONGODB_URL, e as MONGODB_DIRECT_CONNECTION, f as MONGODB_DB_NAME } from \"./private.js\";\nimport { MongoClient, GridFSBucket } from \"mongodb\";\nconst client = new MongoClient(MONGODB_URL, {\n  directConnection: MONGODB_DIRECT_CONNECTION === \"true\"\n});\nclient.connect().catch(console.error);\nconst db = client.db(MONGODB_DB_NAME + \"\");\nconst conversations = db.collection(\"conversations\");\nconst sharedConversations = db.collection(\"sharedConversations\");\nconst abortedGenerations = db.collection(\"abortedGenerations\");\nconst settings = db.collection(\"settings\");\nconst users = db.collection(\"users\");\nconst webSearches = db.collection(\"webSearches\");\nconst messageEvents = db.collection(\"messageEvents\");\nconst bucket = new GridFSBucket(db, { bucketName: \"files\" });\nconst collections = {\n  conversations,\n  sharedConversations,\n  abortedGenerations,\n  settings,\n  users,\n  webSearches,\n  messageEvents,\n  bucket\n};\nclient.on(\"open\", () => {\n  conversations.createIndex(\n    { sessionId: 1, updatedAt: -1 },\n    { partialFilterExpression: { sessionId: { $exists: true } } }\n  ).catch(console.error);\n  conversations.createIndex(\n    { userId: 1, updatedAt: -1 },\n    { partialFilterExpression: { userId: { $exists: true } } }\n  ).catch(console.error);\n  webSearches.createIndex({ sessionId: 1, updatedAt: -1 }).catch(console.error);\n  abortedGenerations.createIndex({ updatedAt: 1 }, { expireAfterSeconds: 30 }).catch(console.error);\n  abortedGenerations.createIndex({ conversationId: 1 }, { unique: true }).catch(console.error);\n  sharedConversations.createIndex({ hash: 1 }, { unique: true }).catch(console.error);\n  settings.createIndex({ sessionId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  settings.createIndex({ userId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  users.createIndex({ hfUserId: 1 }, { unique: true }).catch(console.error);\n  users.createIndex({ sessionId: 1 }, { unique: true, sparse: true }).catch(console.error);\n  messageEvents.createIndex({ createdAt: 1 }, { expireAfterSeconds: 60 }).catch(console.error);\n});\nexport {\n  collections as c\n};\n"],"names":[],"mappings":"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"}