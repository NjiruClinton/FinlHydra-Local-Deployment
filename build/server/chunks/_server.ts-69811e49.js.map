{"version":3,"file":"_server.ts-69811e49.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/search/_id_/_server.ts.js"],"sourcesContent":["import { c as collections } from \"../../../../chunks/database.js\";\nimport { h as hashConv } from \"../../../../chunks/hashConv.js\";\nimport { e as error } from \"../../../../chunks/index.js\";\nimport { ObjectId } from \"mongodb\";\nasync function GET({ params, locals }) {\n  const searchId = new ObjectId(params.id);\n  const search = await collections.webSearches.findOne({\n    _id: searchId\n  });\n  if (!search) {\n    throw error(404, \"Search query not found\");\n  }\n  const conv = await collections.conversations.findOne({\n    _id: search.convId\n  });\n  if (!conv) {\n    throw error(404, \"Conversation not found\");\n  }\n  const hash = await hashConv(conv);\n  const sharedConv = await collections.sharedConversations.findOne({\n    hash\n  });\n  const userShouldSeeConv = conv.userId && locals.user?._id.toString() === conv.userId.toString() || sharedConv !== null;\n  if (!userShouldSeeConv) {\n    throw error(403, \"You don't have access to the conversation here.\");\n  }\n  return new Response(JSON.stringify(search), { headers: { \"Content-Type\": \"application/json\" } });\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;AAIA,eAAe,GAAG,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,EAAE;AACvC,EAAE,MAAM,QAAQ,GAAG,IAAI,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;AAC3C,EAAE,MAAM,MAAM,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,OAAO,CAAC;AACvD,IAAI,GAAG,EAAE,QAAQ;AACjB,GAAG,CAAC,CAAC;AACL,EAAE,IAAI,CAAC,MAAM,EAAE;AACf,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,wBAAwB,CAAC,CAAC;AAC/C,GAAG;AACH,EAAE,MAAM,IAAI,GAAG,MAAM,WAAW,CAAC,aAAa,CAAC,OAAO,CAAC;AACvD,IAAI,GAAG,EAAE,MAAM,CAAC,MAAM;AACtB,GAAG,CAAC,CAAC;AACL,EAAE,IAAI,CAAC,IAAI,EAAE;AACb,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,wBAAwB,CAAC,CAAC;AAC/C,GAAG;AACH,EAAE,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAC;AACpC,EAAE,MAAM,UAAU,GAAG,MAAM,WAAW,CAAC,mBAAmB,CAAC,OAAO,CAAC;AACnE,IAAI,IAAI;AACR,GAAG,CAAC,CAAC;AACL,EAAE,MAAM,iBAAiB,GAAG,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC,QAAQ,EAAE,KAAK,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,IAAI,UAAU,KAAK,IAAI,CAAC;AACzH,EAAE,IAAI,CAAC,iBAAiB,EAAE;AAC1B,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,iDAAiD,CAAC,CAAC;AACxE,GAAG;AACH,EAAE,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,EAAE,OAAO,EAAE,EAAE,cAAc,EAAE,kBAAkB,EAAE,EAAE,CAAC,CAAC;AACnG;;;;"}